name: Criar Sub-Issues a partir de Story

on:
  issues:
    types: [opened]

jobs:
  create-sub-issues:
    runs-on: ubuntu-latest
    steps:
      - name: Verificar tipo de issue
        run: |
          if [[ "${{ github.event.issue.labels.*.name }}" == *"story"* ]]; then
            echo "Criando sub-issues do tipo Feature para o Story..."
            subissues=$(echo "${{ github.event.issue.body }}" | grep -oP '(?<=- \[ \] ).*')
            for subissue in $subissues; do
              gh issue create --title "[Feature] $subissue" --body "Esta é uma sub-issue do Story #${{ github.event.issue.number }}." --label feature
            done
          elif [[ "${{ github.event.issue.labels.*.name }}" == *"feature"* ]]; then
            echo "Criando sub-issues do tipo Task para a Feature..."
            subissues=$(echo "${{ github.event.issue.body }}" | grep -oP '(?<=- \[ \] ).*')
            for subissue in $subissues; do
              gh issue create --title "[Task] $subissue" --body "Esta é uma sub-issue da Feature #${{ github.event.issue.number }}." --label task
            done
          else
            echo "Tipo de issue não suportado para criação automática de sub-issues."
            
